name: PreProd Freeze Window Check

on:
  pull_request:
    branches:
      - pre_prod
  workflow_dispatch:

jobs:
  freeze-check:
    runs-on: ubuntu-latest

    steps:
      - name: Determine current time window (IST 5–6 PM)
        id: window
        run: |
          HOUR=$(date -u +"%H")
          MIN=$(date -u +"%M")
          TIME=$((HOUR*60 + MIN))

          START=$((11*60 + 30))    # 11:30 UTC
          END=$((12*60 + 30))      # 12:30 UTC

          # Produce a final flag
          if [ $TIME -ge $START ] && [ $TIME -le $END ]; then
            echo "within_window=true" >> $GITHUB_OUTPUT
          else
            echo "within_window=false" >> $GITHUB_OUTPUT
          fi

      - name: Auto-pass during freeze open window
        if: ${{ steps.window.outputs.within_window == 'true' }}
        run: echo "Allowed window: auto pass."

      - name: Fail outside 5–6 PM IST
        if: ${{ steps.window.outputs.within_window == 'false' }}
        run: |
          echo "❌ Freeze window active — PR requires manual approval."
          exit 1
